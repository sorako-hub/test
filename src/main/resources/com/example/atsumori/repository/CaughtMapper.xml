<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.atsumori.repository.CaughtMapper">

    <!-- ユーザーIDとタイプで捕った生物ID一覧を取得 -->
    <select id="findCreatureIdsByUserIdAndType"
            parameterType="map"
            resultType="long">
        SELECT creature_id
        FROM caught_creatures
        WHERE user_id = #{userId}
          AND type = #{type}
    </select>

    <!-- ユーザーID・生物ID・タイプの組み合わせが存在するか -->
    <select id="existsByUserIdAndCreatureIdAndType"
            parameterType="map"
            resultType="boolean">
        SELECT COUNT(*) > 0
        FROM caught_creatures
        WHERE user_id = #{userId}
          AND creature_id = #{creatureId}
          AND type = #{type}
    </select>

    <!-- 捕った生物を登録（自動採番ID取得） -->
    <insert id="insertCaughtCreature"
        parameterType="com.example.atsumori.entity.CaughtCreature"
        useGeneratedKeys="true"
        keyProperty="id">
    INSERT INTO caught_creatures (user_id, creature_id, type)
    VALUES (#{userId}, #{creatureId}, #{type})
	</insert>


</mapper>
